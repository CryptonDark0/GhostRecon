{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":55,"index":55}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"./constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":56},"end":{"line":2,"column":39,"index":95}}],"key":"waDaw5D7vDr2hRFu0z1BqRCTzP4=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":96},"end":{"line":3,"column":33,"index":129}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.disconnectWebSocket = disconnectWebSocket;\n  exports.sendWsMessage = sendWsMessage;\n  exports.useWebSocket = useWebSocket;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _constants = require(_dependencyMap[1], \"./constants\");\n  var _api = require(_dependencyMap[2], \"./api\");\n  let globalWs = null;\n  let listeners = new Set();\n  let reconnectTimer = null;\n  const getWsUrl = () => {\n    const base = _constants.API_BASE.replace('/api', '').replace('https://', 'wss://').replace('http://', 'ws://');\n    return `${base}/api/ws`;\n  };\n  async function connectWebSocket() {\n    const token = await (0, _api.getToken)();\n    if (!token || globalWs?.readyState === WebSocket.OPEN) return;\n    try {\n      const wsUrl = `${getWsUrl()}/${token}`;\n      globalWs = new WebSocket(wsUrl);\n      globalWs.onopen = () => {\n        console.log('[WS] Connected');\n        if (reconnectTimer) clearTimeout(reconnectTimer);\n      };\n      globalWs.onmessage = event => {\n        try {\n          const data = JSON.parse(event.data);\n          listeners.forEach(cb => cb(data));\n        } catch {}\n      };\n      globalWs.onclose = () => {\n        console.log('[WS] Disconnected, reconnecting...');\n        globalWs = null;\n        reconnectTimer = setTimeout(connectWebSocket, 3000);\n      };\n      globalWs.onerror = () => {\n        globalWs?.close();\n      };\n\n      // Keepalive ping\n      const pingInterval = setInterval(() => {\n        if (globalWs?.readyState === WebSocket.OPEN) {\n          globalWs.send(JSON.stringify({\n            type: 'ping'\n          }));\n        } else {\n          clearInterval(pingInterval);\n        }\n      }, 30000);\n    } catch {\n      reconnectTimer = setTimeout(connectWebSocket, 5000);\n    }\n  }\n  function disconnectWebSocket() {\n    if (reconnectTimer) clearTimeout(reconnectTimer);\n    reconnectTimer = null;\n    globalWs?.close();\n    globalWs = null;\n    listeners.clear();\n  }\n  function sendWsMessage(data) {\n    if (globalWs?.readyState === WebSocket.OPEN) {\n      globalWs.send(JSON.stringify(data));\n    }\n  }\n  function useWebSocket(onMessage) {\n    _s();\n    const callbackRef = (0, _react.useRef)(onMessage);\n    callbackRef.current = onMessage;\n    (0, _react.useEffect)(() => {\n      connectWebSocket();\n      const handler = msg => {\n        callbackRef.current?.(msg);\n      };\n      if (onMessage) {\n        listeners.add(handler);\n      }\n      return () => {\n        listeners.delete(handler);\n      };\n    }, []);\n    return {\n      sendMessage: sendWsMessage\n    };\n  }\n  _s(useWebSocket, \"w2NYHMIDbKnRziekrLIRqvurYl0=\");\n});","lineCount":93,"map":[[8,2,64,0,"exports"],[8,9,64,0],[8,10,64,0,"disconnectWebSocket"],[8,29,64,0],[8,32,64,0,"disconnectWebSocket"],[8,51,64,0],[9,2,72,0,"exports"],[9,9,72,0],[9,10,72,0,"sendWsMessage"],[9,23,72,0],[9,26,72,0,"sendWsMessage"],[9,39,72,0],[10,2,78,0,"exports"],[10,9,78,0],[10,10,78,0,"useWebSocket"],[10,22,78,0],[10,25,78,0,"useWebSocket"],[10,37,78,0],[11,2,1,0],[11,6,1,0,"_react"],[11,12,1,0],[11,15,1,0,"require"],[11,22,1,0],[11,23,1,0,"_dependencyMap"],[11,37,1,0],[12,2,2,0],[12,6,2,0,"_constants"],[12,16,2,0],[12,19,2,0,"require"],[12,26,2,0],[12,27,2,0,"_dependencyMap"],[12,41,2,0],[13,2,3,0],[13,6,3,0,"_api"],[13,10,3,0],[13,13,3,0,"require"],[13,20,3,0],[13,21,3,0,"_dependencyMap"],[13,35,3,0],[14,2,12,0],[14,6,12,4,"globalWs"],[14,14,12,30],[14,17,12,33],[14,21,12,37],[15,2,13,0],[15,6,13,4,"listeners"],[15,15,13,30],[15,18,13,33],[15,22,13,37,"Set"],[15,25,13,40],[15,26,13,41],[15,27,13,42],[16,2,14,0],[16,6,14,4,"reconnectTimer"],[16,20,14,56],[16,23,14,59],[16,27,14,63],[17,2,16,0],[17,8,16,6,"getWsUrl"],[17,16,16,14],[17,19,16,17,"getWsUrl"],[17,20,16,17],[17,25,16,23],[18,4,17,2],[18,10,17,8,"base"],[18,14,17,12],[18,17,17,15,"API_BASE"],[18,27,17,23],[18,28,17,23,"API_BASE"],[18,36,17,23],[18,37,17,24,"replace"],[18,44,17,31],[18,45,17,32],[18,51,17,38],[18,53,17,40],[18,55,17,42],[18,56,17,43],[18,57,17,44,"replace"],[18,64,17,51],[18,65,17,52],[18,75,17,62],[18,77,17,64],[18,85,17,72],[18,86,17,73],[18,87,17,74,"replace"],[18,94,17,81],[18,95,17,82],[18,104,17,91],[18,106,17,93],[18,113,17,100],[18,114,17,101],[19,4,18,2],[19,11,18,9],[19,14,18,12,"base"],[19,18,18,16],[19,27,18,25],[20,2,19,0],[20,3,19,1],[21,2,21,0],[21,17,21,15,"connectWebSocket"],[21,33,21,31,"connectWebSocket"],[21,34,21,31],[21,36,21,34],[22,4,22,2],[22,10,22,8,"token"],[22,15,22,13],[22,18,22,16],[22,24,22,22],[22,28,22,22,"getToken"],[22,32,22,30],[22,33,22,30,"getToken"],[22,41,22,30],[22,43,22,31],[22,44,22,32],[23,4,23,2],[23,8,23,6],[23,9,23,7,"token"],[23,14,23,12],[23,18,23,16,"globalWs"],[23,26,23,24],[23,28,23,26,"readyState"],[23,38,23,36],[23,43,23,41,"WebSocket"],[23,52,23,50],[23,53,23,51,"OPEN"],[23,57,23,55],[23,59,23,57],[24,4,25,2],[24,8,25,6],[25,6,26,4],[25,12,26,10,"wsUrl"],[25,17,26,15],[25,20,26,18],[25,23,26,21,"getWsUrl"],[25,31,26,29],[25,32,26,30],[25,33,26,31],[25,37,26,35,"token"],[25,42,26,40],[25,44,26,42],[26,6,27,4,"globalWs"],[26,14,27,12],[26,17,27,15],[26,21,27,19,"WebSocket"],[26,30,27,28],[26,31,27,29,"wsUrl"],[26,36,27,34],[26,37,27,35],[27,6,29,4,"globalWs"],[27,14,29,12],[27,15,29,13,"onopen"],[27,21,29,19],[27,24,29,22],[27,30,29,28],[28,8,30,6,"console"],[28,15,30,13],[28,16,30,14,"log"],[28,19,30,17],[28,20,30,18],[28,36,30,34],[28,37,30,35],[29,8,31,6],[29,12,31,10,"reconnectTimer"],[29,26,31,24],[29,28,31,26,"clearTimeout"],[29,40,31,38],[29,41,31,39,"reconnectTimer"],[29,55,31,53],[29,56,31,54],[30,6,32,4],[30,7,32,5],[31,6,34,4,"globalWs"],[31,14,34,12],[31,15,34,13,"onmessage"],[31,24,34,22],[31,27,34,26,"event"],[31,32,34,31],[31,36,34,36],[32,8,35,6],[32,12,35,10],[33,10,36,8],[33,16,36,14,"data"],[33,20,36,18],[33,23,36,21,"JSON"],[33,27,36,25],[33,28,36,26,"parse"],[33,33,36,31],[33,34,36,32,"event"],[33,39,36,37],[33,40,36,38,"data"],[33,44,36,42],[33,45,36,43],[34,10,37,8,"listeners"],[34,19,37,17],[34,20,37,18,"forEach"],[34,27,37,25],[34,28,37,26,"cb"],[34,30,37,28],[34,34,37,32,"cb"],[34,36,37,34],[34,37,37,35,"data"],[34,41,37,39],[34,42,37,40],[34,43,37,41],[35,8,38,6],[35,9,38,7],[35,10,38,8],[35,16,38,14],[35,17,38,15],[36,6,39,4],[36,7,39,5],[37,6,41,4,"globalWs"],[37,14,41,12],[37,15,41,13,"onclose"],[37,22,41,20],[37,25,41,23],[37,31,41,29],[38,8,42,6,"console"],[38,15,42,13],[38,16,42,14,"log"],[38,19,42,17],[38,20,42,18],[38,56,42,54],[38,57,42,55],[39,8,43,6,"globalWs"],[39,16,43,14],[39,19,43,17],[39,23,43,21],[40,8,44,6,"reconnectTimer"],[40,22,44,20],[40,25,44,23,"setTimeout"],[40,35,44,33],[40,36,44,34,"connectWebSocket"],[40,52,44,50],[40,54,44,52],[40,58,44,56],[40,59,44,57],[41,6,45,4],[41,7,45,5],[42,6,47,4,"globalWs"],[42,14,47,12],[42,15,47,13,"onerror"],[42,22,47,20],[42,25,47,23],[42,31,47,29],[43,8,48,6,"globalWs"],[43,16,48,14],[43,18,48,16,"close"],[43,23,48,21],[43,24,48,22],[43,25,48,23],[44,6,49,4],[44,7,49,5],[46,6,51,4],[47,6,52,4],[47,12,52,10,"pingInterval"],[47,24,52,22],[47,27,52,25,"setInterval"],[47,38,52,36],[47,39,52,37],[47,45,52,43],[48,8,53,6],[48,12,53,10,"globalWs"],[48,20,53,18],[48,22,53,20,"readyState"],[48,32,53,30],[48,37,53,35,"WebSocket"],[48,46,53,44],[48,47,53,45,"OPEN"],[48,51,53,49],[48,53,53,51],[49,10,54,8,"globalWs"],[49,18,54,16],[49,19,54,17,"send"],[49,23,54,21],[49,24,54,22,"JSON"],[49,28,54,26],[49,29,54,27,"stringify"],[49,38,54,36],[49,39,54,37],[50,12,54,39,"type"],[50,16,54,43],[50,18,54,45],[51,10,54,52],[51,11,54,53],[51,12,54,54],[51,13,54,55],[52,8,55,6],[52,9,55,7],[52,15,55,13],[53,10,56,8,"clearInterval"],[53,23,56,21],[53,24,56,22,"pingInterval"],[53,36,56,34],[53,37,56,35],[54,8,57,6],[55,6,58,4],[55,7,58,5],[55,9,58,7],[55,14,58,12],[55,15,58,13],[56,4,59,2],[56,5,59,3],[56,6,59,4],[56,12,59,10],[57,6,60,4,"reconnectTimer"],[57,20,60,18],[57,23,60,21,"setTimeout"],[57,33,60,31],[57,34,60,32,"connectWebSocket"],[57,50,60,48],[57,52,60,50],[57,56,60,54],[57,57,60,55],[58,4,61,2],[59,2,62,0],[60,2,64,7],[60,11,64,16,"disconnectWebSocket"],[60,30,64,35,"disconnectWebSocket"],[60,31,64,35],[60,33,64,38],[61,4,65,2],[61,8,65,6,"reconnectTimer"],[61,22,65,20],[61,24,65,22,"clearTimeout"],[61,36,65,34],[61,37,65,35,"reconnectTimer"],[61,51,65,49],[61,52,65,50],[62,4,66,2,"reconnectTimer"],[62,18,66,16],[62,21,66,19],[62,25,66,23],[63,4,67,2,"globalWs"],[63,12,67,10],[63,14,67,12,"close"],[63,19,67,17],[63,20,67,18],[63,21,67,19],[64,4,68,2,"globalWs"],[64,12,68,10],[64,15,68,13],[64,19,68,17],[65,4,69,2,"listeners"],[65,13,69,11],[65,14,69,12,"clear"],[65,19,69,17],[65,20,69,18],[65,21,69,19],[66,2,70,0],[67,2,72,7],[67,11,72,16,"sendWsMessage"],[67,24,72,29,"sendWsMessage"],[67,25,72,30,"data"],[67,29,72,39],[67,31,72,41],[68,4,73,2],[68,8,73,6,"globalWs"],[68,16,73,14],[68,18,73,16,"readyState"],[68,28,73,26],[68,33,73,31,"WebSocket"],[68,42,73,40],[68,43,73,41,"OPEN"],[68,47,73,45],[68,49,73,47],[69,6,74,4,"globalWs"],[69,14,74,12],[69,15,74,13,"send"],[69,19,74,17],[69,20,74,18,"JSON"],[69,24,74,22],[69,25,74,23,"stringify"],[69,34,74,32],[69,35,74,33,"data"],[69,39,74,37],[69,40,74,38],[69,41,74,39],[70,4,75,2],[71,2,76,0],[72,2,78,7],[72,11,78,16,"useWebSocket"],[72,23,78,28,"useWebSocket"],[72,24,78,29,"onMessage"],[72,33,78,51],[72,35,78,53],[73,4,78,53,"_s"],[73,6,78,53],[74,4,79,2],[74,10,79,8,"callbackRef"],[74,21,79,19],[74,24,79,22],[74,28,79,22,"useRef"],[74,34,79,28],[74,35,79,28,"useRef"],[74,41,79,28],[74,43,79,29,"onMessage"],[74,52,79,38],[74,53,79,39],[75,4,80,2,"callbackRef"],[75,15,80,13],[75,16,80,14,"current"],[75,23,80,21],[75,26,80,24,"onMessage"],[75,35,80,33],[76,4,82,2],[76,8,82,2,"useEffect"],[76,14,82,11],[76,15,82,11,"useEffect"],[76,24,82,11],[76,26,82,12],[76,32,82,18],[77,6,83,4,"connectWebSocket"],[77,22,83,20],[77,23,83,21],[77,24,83,22],[78,6,85,4],[78,12,85,10,"handler"],[78,19,85,29],[78,22,85,33,"msg"],[78,25,85,36],[78,29,85,41],[79,8,86,6,"callbackRef"],[79,19,86,17],[79,20,86,18,"current"],[79,27,86,25],[79,30,86,28,"msg"],[79,33,86,31],[79,34,86,32],[80,6,87,4],[80,7,87,5],[81,6,89,4],[81,10,89,8,"onMessage"],[81,19,89,17],[81,21,89,19],[82,8,90,6,"listeners"],[82,17,90,15],[82,18,90,16,"add"],[82,21,90,19],[82,22,90,20,"handler"],[82,29,90,27],[82,30,90,28],[83,6,91,4],[84,6,93,4],[84,13,93,11],[84,19,93,17],[85,8,94,6,"listeners"],[85,17,94,15],[85,18,94,16,"delete"],[85,24,94,22],[85,25,94,23,"handler"],[85,32,94,30],[85,33,94,31],[86,6,95,4],[86,7,95,5],[87,4,96,2],[87,5,96,3],[87,7,96,5],[87,9,96,7],[87,10,96,8],[88,4,98,2],[88,11,98,9],[89,6,98,11,"sendMessage"],[89,17,98,22],[89,19,98,24,"sendWsMessage"],[90,4,98,38],[90,5,98,39],[91,2,99,0],[92,2,99,1,"_s"],[92,4,99,1],[92,5,78,16,"useWebSocket"],[92,17,78,28],[93,0,78,28],[93,3]],"functionMap":{"names":["<global>","getWsUrl","connectWebSocket","globalWs.onopen","globalWs.onmessage","listeners.forEach$argument_0","globalWs.onclose","globalWs.onerror","setInterval$argument_0","disconnectWebSocket","sendWsMessage","useWebSocket","useEffect$argument_0","handler","<anonymous>"],"mappings":"AAA;iBCe;CDG;AEE;sBCQ;KDG;yBEE;0BCG,cD;KFE;uBIE;KJI;uBKE;KLE;qCMG;KNM;CFI;OSE;CTM;OUE;CVI;OWE;YCI;gCCG;KDE;WEM;KFE;GDC;CXG"},"hasCjsExports":false},"type":"js/module"}]}