{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":55,"index":55}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"./constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":57},"end":{"line":2,"column":39,"index":96}}],"key":"waDaw5D7vDr2hRFu0z1BqRCTzP4=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":98},"end":{"line":3,"column":33,"index":131}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.disconnectWebSocket = disconnectWebSocket;\n  exports.sendWsMessage = sendWsMessage;\n  exports.useWebSocket = useWebSocket;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1], \"react\");\n  var _constants = require(_dependencyMap[2], \"./constants\");\n  var _api = require(_dependencyMap[3], \"./api\");\n  var globalWs = null;\n  var listeners = new Set();\n  var reconnectTimer = null;\n  var getWsUrl = () => {\n    var base = _constants.API_BASE.replace('/api', '').replace('https://', 'wss://').replace('http://', 'ws://');\n    return `${base}/api/ws`;\n  };\n  function connectWebSocket() {\n    return _connectWebSocket.apply(this, arguments);\n  }\n  function _connectWebSocket() {\n    _connectWebSocket = (0, _asyncToGenerator.default)(function* () {\n      var token = yield (0, _api.getToken)();\n      if (!token || globalWs?.readyState === WebSocket.OPEN) return;\n      try {\n        var wsUrl = `${getWsUrl()}/${token}`;\n        globalWs = new WebSocket(wsUrl);\n        globalWs.onopen = () => {\n          console.log('[WS] Connected');\n          if (reconnectTimer) clearTimeout(reconnectTimer);\n        };\n        globalWs.onmessage = event => {\n          try {\n            var data = JSON.parse(event.data);\n            listeners.forEach(cb => cb(data));\n          } catch {}\n        };\n        globalWs.onclose = () => {\n          console.log('[WS] Disconnected, reconnecting...');\n          globalWs = null;\n          reconnectTimer = setTimeout(connectWebSocket, 3000);\n        };\n        globalWs.onerror = () => {\n          globalWs?.close();\n        };\n\n        // Keepalive ping\n        var pingInterval = setInterval(() => {\n          if (globalWs?.readyState === WebSocket.OPEN) {\n            globalWs.send(JSON.stringify({\n              type: 'ping'\n            }));\n          } else {\n            clearInterval(pingInterval);\n          }\n        }, 30000);\n      } catch {\n        reconnectTimer = setTimeout(connectWebSocket, 5000);\n      }\n    });\n    return _connectWebSocket.apply(this, arguments);\n  }\n  function disconnectWebSocket() {\n    if (reconnectTimer) clearTimeout(reconnectTimer);\n    reconnectTimer = null;\n    globalWs?.close();\n    globalWs = null;\n    listeners.clear();\n  }\n  function sendWsMessage(data) {\n    if (globalWs?.readyState === WebSocket.OPEN) {\n      globalWs.send(JSON.stringify(data));\n    }\n  }\n  function useWebSocket(onMessage) {\n    _s();\n    var callbackRef = (0, _react.useRef)(onMessage);\n    callbackRef.current = onMessage;\n    (0, _react.useEffect)(() => {\n      connectWebSocket();\n      var handler = msg => {\n        callbackRef.current?.(msg);\n      };\n      if (onMessage) {\n        listeners.add(handler);\n      }\n      return () => {\n        listeners.delete(handler);\n      };\n    }, []);\n    return {\n      sendMessage: sendWsMessage\n    };\n  }\n  _s(useWebSocket, \"w2NYHMIDbKnRziekrLIRqvurYl0=\");\n});","lineCount":106,"map":[[13,2,64,0,"exports"],[13,9,64,0],[13,10,64,0,"disconnectWebSocket"],[13,29,64,0],[13,32,64,0,"disconnectWebSocket"],[13,51,64,0],[14,2,72,0,"exports"],[14,9,72,0],[14,10,72,0,"sendWsMessage"],[14,23,72,0],[14,26,72,0,"sendWsMessage"],[14,39,72,0],[15,2,78,0,"exports"],[15,9,78,0],[15,10,78,0,"useWebSocket"],[15,22,78,0],[15,25,78,0,"useWebSocket"],[15,37,78,0],[16,2,99,1],[16,6,99,1,"_babelRuntimeHelpersAsyncToGenerator"],[16,42,99,1],[16,45,99,1,"require"],[16,52,99,1],[16,53,99,1,"_dependencyMap"],[16,67,99,1],[17,2,99,1],[17,6,99,1,"_asyncToGenerator"],[17,23,99,1],[17,26,99,1,"_interopDefault"],[17,41,99,1],[17,42,99,1,"_babelRuntimeHelpersAsyncToGenerator"],[17,78,99,1],[18,2,1,0],[18,6,1,0,"_react"],[18,12,1,0],[18,15,1,0,"require"],[18,22,1,0],[18,23,1,0,"_dependencyMap"],[18,37,1,0],[19,2,2,0],[19,6,2,0,"_constants"],[19,16,2,0],[19,19,2,0,"require"],[19,26,2,0],[19,27,2,0,"_dependencyMap"],[19,41,2,0],[20,2,3,0],[20,6,3,0,"_api"],[20,10,3,0],[20,13,3,0,"require"],[20,20,3,0],[20,21,3,0,"_dependencyMap"],[20,35,3,0],[21,2,12,0],[21,6,12,4,"globalWs"],[21,14,12,30],[21,17,12,33],[21,21,12,37],[22,2,13,0],[22,6,13,4,"listeners"],[22,15,13,30],[22,18,13,33],[22,22,13,37,"Set"],[22,25,13,40],[22,26,13,41],[22,27,13,42],[23,2,14,0],[23,6,14,4,"reconnectTimer"],[23,20,14,56],[23,23,14,59],[23,27,14,63],[24,2,16,0],[24,6,16,6,"getWsUrl"],[24,14,16,14],[24,17,16,17,"getWsUrl"],[24,18,16,17],[24,23,16,23],[25,4,17,2],[25,8,17,8,"base"],[25,12,17,12],[25,15,17,15,"API_BASE"],[25,25,17,23],[25,26,17,23,"API_BASE"],[25,34,17,23],[25,35,17,24,"replace"],[25,42,17,31],[25,43,17,32],[25,49,17,38],[25,51,17,40],[25,53,17,42],[25,54,17,43],[25,55,17,44,"replace"],[25,62,17,51],[25,63,17,52],[25,73,17,62],[25,75,17,64],[25,83,17,72],[25,84,17,73],[25,85,17,74,"replace"],[25,92,17,81],[25,93,17,82],[25,102,17,91],[25,104,17,93],[25,111,17,100],[25,112,17,101],[26,4,18,2],[26,11,18,9],[26,14,18,12,"base"],[26,18,18,16],[26,27,18,25],[27,2,19,0],[27,3,19,1],[28,2,19,2],[28,11,21,15,"connectWebSocket"],[28,27,21,31,"connectWebSocket"],[28,28,21,31],[29,4,21,31],[29,11,21,31,"_connectWebSocket"],[29,28,21,31],[29,29,21,31,"apply"],[29,34,21,31],[29,41,21,31,"arguments"],[29,50,21,31],[30,2,21,31],[31,2,21,31],[31,11,21,31,"_connectWebSocket"],[31,29,21,31],[32,4,21,31,"_connectWebSocket"],[32,21,21,31],[32,28,21,31,"_asyncToGenerator"],[32,45,21,31],[32,46,21,31,"default"],[32,53,21,31],[32,55,21,0],[32,68,21,34],[33,6,22,2],[33,10,22,8,"token"],[33,15,22,13],[33,24,22,22],[33,28,22,22,"getToken"],[33,32,22,30],[33,33,22,30,"getToken"],[33,41,22,30],[33,43,22,31],[33,44,22,32],[34,6,23,2],[34,10,23,6],[34,11,23,7,"token"],[34,16,23,12],[34,20,23,16,"globalWs"],[34,28,23,24],[34,30,23,26,"readyState"],[34,40,23,36],[34,45,23,41,"WebSocket"],[34,54,23,50],[34,55,23,51,"OPEN"],[34,59,23,55],[34,61,23,57],[35,6,25,2],[35,10,25,6],[36,8,26,4],[36,12,26,10,"wsUrl"],[36,17,26,15],[36,20,26,18],[36,23,26,21,"getWsUrl"],[36,31,26,29],[36,32,26,30],[36,33,26,31],[36,37,26,35,"token"],[36,42,26,40],[36,44,26,42],[37,8,27,4,"globalWs"],[37,16,27,12],[37,19,27,15],[37,23,27,19,"WebSocket"],[37,32,27,28],[37,33,27,29,"wsUrl"],[37,38,27,34],[37,39,27,35],[38,8,29,4,"globalWs"],[38,16,29,12],[38,17,29,13,"onopen"],[38,23,29,19],[38,26,29,22],[38,32,29,28],[39,10,30,6,"console"],[39,17,30,13],[39,18,30,14,"log"],[39,21,30,17],[39,22,30,18],[39,38,30,34],[39,39,30,35],[40,10,31,6],[40,14,31,10,"reconnectTimer"],[40,28,31,24],[40,30,31,26,"clearTimeout"],[40,42,31,38],[40,43,31,39,"reconnectTimer"],[40,57,31,53],[40,58,31,54],[41,8,32,4],[41,9,32,5],[42,8,34,4,"globalWs"],[42,16,34,12],[42,17,34,13,"onmessage"],[42,26,34,22],[42,29,34,26,"event"],[42,34,34,31],[42,38,34,36],[43,10,35,6],[43,14,35,10],[44,12,36,8],[44,16,36,14,"data"],[44,20,36,18],[44,23,36,21,"JSON"],[44,27,36,25],[44,28,36,26,"parse"],[44,33,36,31],[44,34,36,32,"event"],[44,39,36,37],[44,40,36,38,"data"],[44,44,36,42],[44,45,36,43],[45,12,37,8,"listeners"],[45,21,37,17],[45,22,37,18,"forEach"],[45,29,37,25],[45,30,37,26,"cb"],[45,32,37,28],[45,36,37,32,"cb"],[45,38,37,34],[45,39,37,35,"data"],[45,43,37,39],[45,44,37,40],[45,45,37,41],[46,10,38,6],[46,11,38,7],[46,12,38,8],[46,18,38,14],[46,19,38,15],[47,8,39,4],[47,9,39,5],[48,8,41,4,"globalWs"],[48,16,41,12],[48,17,41,13,"onclose"],[48,24,41,20],[48,27,41,23],[48,33,41,29],[49,10,42,6,"console"],[49,17,42,13],[49,18,42,14,"log"],[49,21,42,17],[49,22,42,18],[49,58,42,54],[49,59,42,55],[50,10,43,6,"globalWs"],[50,18,43,14],[50,21,43,17],[50,25,43,21],[51,10,44,6,"reconnectTimer"],[51,24,44,20],[51,27,44,23,"setTimeout"],[51,37,44,33],[51,38,44,34,"connectWebSocket"],[51,54,44,50],[51,56,44,52],[51,60,44,56],[51,61,44,57],[52,8,45,4],[52,9,45,5],[53,8,47,4,"globalWs"],[53,16,47,12],[53,17,47,13,"onerror"],[53,24,47,20],[53,27,47,23],[53,33,47,29],[54,10,48,6,"globalWs"],[54,18,48,14],[54,20,48,16,"close"],[54,25,48,21],[54,26,48,22],[54,27,48,23],[55,8,49,4],[55,9,49,5],[57,8,51,4],[58,8,52,4],[58,12,52,10,"pingInterval"],[58,24,52,22],[58,27,52,25,"setInterval"],[58,38,52,36],[58,39,52,37],[58,45,52,43],[59,10,53,6],[59,14,53,10,"globalWs"],[59,22,53,18],[59,24,53,20,"readyState"],[59,34,53,30],[59,39,53,35,"WebSocket"],[59,48,53,44],[59,49,53,45,"OPEN"],[59,53,53,49],[59,55,53,51],[60,12,54,8,"globalWs"],[60,20,54,16],[60,21,54,17,"send"],[60,25,54,21],[60,26,54,22,"JSON"],[60,30,54,26],[60,31,54,27,"stringify"],[60,40,54,36],[60,41,54,37],[61,14,54,39,"type"],[61,18,54,43],[61,20,54,45],[62,12,54,52],[62,13,54,53],[62,14,54,54],[62,15,54,55],[63,10,55,6],[63,11,55,7],[63,17,55,13],[64,12,56,8,"clearInterval"],[64,25,56,21],[64,26,56,22,"pingInterval"],[64,38,56,34],[64,39,56,35],[65,10,57,6],[66,8,58,4],[66,9,58,5],[66,11,58,7],[66,16,58,12],[66,17,58,13],[67,6,59,2],[67,7,59,3],[67,8,59,4],[67,14,59,10],[68,8,60,4,"reconnectTimer"],[68,22,60,18],[68,25,60,21,"setTimeout"],[68,35,60,31],[68,36,60,32,"connectWebSocket"],[68,52,60,48],[68,54,60,50],[68,58,60,54],[68,59,60,55],[69,6,61,2],[70,4,62,0],[70,5,62,1],[71,4,62,1],[71,11,62,1,"_connectWebSocket"],[71,28,62,1],[71,29,62,1,"apply"],[71,34,62,1],[71,41,62,1,"arguments"],[71,50,62,1],[72,2,62,1],[73,2,64,7],[73,11,64,16,"disconnectWebSocket"],[73,30,64,35,"disconnectWebSocket"],[73,31,64,35],[73,33,64,38],[74,4,65,2],[74,8,65,6,"reconnectTimer"],[74,22,65,20],[74,24,65,22,"clearTimeout"],[74,36,65,34],[74,37,65,35,"reconnectTimer"],[74,51,65,49],[74,52,65,50],[75,4,66,2,"reconnectTimer"],[75,18,66,16],[75,21,66,19],[75,25,66,23],[76,4,67,2,"globalWs"],[76,12,67,10],[76,14,67,12,"close"],[76,19,67,17],[76,20,67,18],[76,21,67,19],[77,4,68,2,"globalWs"],[77,12,68,10],[77,15,68,13],[77,19,68,17],[78,4,69,2,"listeners"],[78,13,69,11],[78,14,69,12,"clear"],[78,19,69,17],[78,20,69,18],[78,21,69,19],[79,2,70,0],[80,2,72,7],[80,11,72,16,"sendWsMessage"],[80,24,72,29,"sendWsMessage"],[80,25,72,30,"data"],[80,29,72,39],[80,31,72,41],[81,4,73,2],[81,8,73,6,"globalWs"],[81,16,73,14],[81,18,73,16,"readyState"],[81,28,73,26],[81,33,73,31,"WebSocket"],[81,42,73,40],[81,43,73,41,"OPEN"],[81,47,73,45],[81,49,73,47],[82,6,74,4,"globalWs"],[82,14,74,12],[82,15,74,13,"send"],[82,19,74,17],[82,20,74,18,"JSON"],[82,24,74,22],[82,25,74,23,"stringify"],[82,34,74,32],[82,35,74,33,"data"],[82,39,74,37],[82,40,74,38],[82,41,74,39],[83,4,75,2],[84,2,76,0],[85,2,78,7],[85,11,78,16,"useWebSocket"],[85,23,78,28,"useWebSocket"],[85,24,78,29,"onMessage"],[85,33,78,51],[85,35,78,53],[86,4,78,53,"_s"],[86,6,78,53],[87,4,79,2],[87,8,79,8,"callbackRef"],[87,19,79,19],[87,22,79,22],[87,26,79,22,"useRef"],[87,32,79,28],[87,33,79,28,"useRef"],[87,39,79,28],[87,41,79,29,"onMessage"],[87,50,79,38],[87,51,79,39],[88,4,80,2,"callbackRef"],[88,15,80,13],[88,16,80,14,"current"],[88,23,80,21],[88,26,80,24,"onMessage"],[88,35,80,33],[89,4,82,2],[89,8,82,2,"useEffect"],[89,14,82,11],[89,15,82,11,"useEffect"],[89,24,82,11],[89,26,82,12],[89,32,82,18],[90,6,83,4,"connectWebSocket"],[90,22,83,20],[90,23,83,21],[90,24,83,22],[91,6,85,4],[91,10,85,10,"handler"],[91,17,85,29],[91,20,85,33,"msg"],[91,23,85,36],[91,27,85,41],[92,8,86,6,"callbackRef"],[92,19,86,17],[92,20,86,18,"current"],[92,27,86,25],[92,30,86,28,"msg"],[92,33,86,31],[92,34,86,32],[93,6,87,4],[93,7,87,5],[94,6,89,4],[94,10,89,8,"onMessage"],[94,19,89,17],[94,21,89,19],[95,8,90,6,"listeners"],[95,17,90,15],[95,18,90,16,"add"],[95,21,90,19],[95,22,90,20,"handler"],[95,29,90,27],[95,30,90,28],[96,6,91,4],[97,6,93,4],[97,13,93,11],[97,19,93,17],[98,8,94,6,"listeners"],[98,17,94,15],[98,18,94,16,"delete"],[98,24,94,22],[98,25,94,23,"handler"],[98,32,94,30],[98,33,94,31],[99,6,95,4],[99,7,95,5],[100,4,96,2],[100,5,96,3],[100,7,96,5],[100,9,96,7],[100,10,96,8],[101,4,98,2],[101,11,98,9],[102,6,98,11,"sendMessage"],[102,17,98,22],[102,19,98,24,"sendWsMessage"],[103,4,98,38],[103,5,98,39],[104,2,99,0],[105,2,99,1,"_s"],[105,4,99,1],[105,5,78,16,"useWebSocket"],[105,17,78,28],[106,0,78,28],[106,3]],"functionMap":{"names":["<global>","getWsUrl","connectWebSocket","globalWs.onopen","globalWs.onmessage","listeners.forEach$argument_0","globalWs.onclose","globalWs.onerror","setInterval$argument_0","disconnectWebSocket","sendWsMessage","useWebSocket","useEffect$argument_0","handler","<anonymous>"],"mappings":"AAA;iBCe;CDG;AEE;sBCQ;KDG;yBEE;0BCG,cD;KFE;uBIE;KJI;uBKE;KLE;qCMG;KNM;CFI;OSE;CTM;OUE;CVI;OWE;YCI;gCCG;KDE;WEM;KFE;GDC;CXG"},"hasCjsExports":false},"type":"js/module"}]}