{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":55,"index":55}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"./constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":57},"end":{"line":2,"column":39,"index":96}}],"key":"waDaw5D7vDr2hRFu0z1BqRCTzP4=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":98},"end":{"line":3,"column":33,"index":131}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.disconnectWebSocket = disconnectWebSocket;\n  exports.sendWsMessage = sendWsMessage;\n  exports.useWebSocket = useWebSocket;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _constants = require(_dependencyMap[1], \"./constants\");\n  var _api = require(_dependencyMap[2], \"./api\");\n  let globalWs = null;\n  let listeners = new Set();\n  let reconnectTimer = null;\n  const getWsUrl = () => {\n    const base = _constants.API_BASE.replace('/api', '').replace('https://', 'wss://').replace('http://', 'ws://');\n    return `${base}/api/ws`;\n  };\n  async function connectWebSocket() {\n    const token = await (0, _api.getToken)();\n    if (!token || globalWs?.readyState === WebSocket.OPEN) return;\n    try {\n      const wsUrl = `${getWsUrl()}/${token}`;\n      globalWs = new WebSocket(wsUrl);\n      globalWs.onopen = () => {\n        console.log('[WS] Connected');\n        if (reconnectTimer) clearTimeout(reconnectTimer);\n      };\n      globalWs.onmessage = event => {\n        try {\n          const data = JSON.parse(event.data);\n          listeners.forEach(cb => cb(data));\n        } catch {}\n      };\n      globalWs.onclose = () => {\n        console.log('[WS] Disconnected, reconnecting...');\n        globalWs = null;\n        reconnectTimer = setTimeout(connectWebSocket, 3000);\n      };\n      globalWs.onerror = () => {\n        globalWs?.close();\n      };\n\n      // Keepalive ping\n      const pingInterval = setInterval(() => {\n        if (globalWs?.readyState === WebSocket.OPEN) {\n          globalWs.send(JSON.stringify({\n            type: 'ping'\n          }));\n        } else {\n          clearInterval(pingInterval);\n        }\n      }, 30000);\n    } catch {\n      reconnectTimer = setTimeout(connectWebSocket, 5000);\n    }\n  }\n  function disconnectWebSocket() {\n    if (reconnectTimer) clearTimeout(reconnectTimer);\n    reconnectTimer = null;\n    globalWs?.close();\n    globalWs = null;\n    listeners.clear();\n  }\n  function sendWsMessage(data) {\n    if (globalWs?.readyState === WebSocket.OPEN) {\n      globalWs.send(JSON.stringify(data));\n    }\n  }\n  function useWebSocket(onMessage) {\n    const callbackRef = (0, _react.useRef)(onMessage);\n    callbackRef.current = onMessage;\n    (0, _react.useEffect)(() => {\n      connectWebSocket();\n      const handler = msg => {\n        callbackRef.current?.(msg);\n      };\n      if (onMessage) {\n        listeners.add(handler);\n      }\n      return () => {\n        listeners.delete(handler);\n      };\n    }, []);\n    return {\n      sendMessage: sendWsMessage\n    };\n  }\n});","lineCount":90,"map":[[7,2,64,0,"exports"],[7,9,64,0],[7,10,64,0,"disconnectWebSocket"],[7,29,64,0],[7,32,64,0,"disconnectWebSocket"],[7,51,64,0],[8,2,72,0,"exports"],[8,9,72,0],[8,10,72,0,"sendWsMessage"],[8,23,72,0],[8,26,72,0,"sendWsMessage"],[8,39,72,0],[9,2,78,0,"exports"],[9,9,78,0],[9,10,78,0,"useWebSocket"],[9,22,78,0],[9,25,78,0,"useWebSocket"],[9,37,78,0],[10,2,1,0],[10,6,1,0,"_react"],[10,12,1,0],[10,15,1,0,"require"],[10,22,1,0],[10,23,1,0,"_dependencyMap"],[10,37,1,0],[11,2,2,0],[11,6,2,0,"_constants"],[11,16,2,0],[11,19,2,0,"require"],[11,26,2,0],[11,27,2,0,"_dependencyMap"],[11,41,2,0],[12,2,3,0],[12,6,3,0,"_api"],[12,10,3,0],[12,13,3,0,"require"],[12,20,3,0],[12,21,3,0,"_dependencyMap"],[12,35,3,0],[13,2,12,0],[13,6,12,4,"globalWs"],[13,14,12,30],[13,17,12,33],[13,21,12,37],[14,2,13,0],[14,6,13,4,"listeners"],[14,15,13,30],[14,18,13,33],[14,22,13,37,"Set"],[14,25,13,40],[14,26,13,41],[14,27,13,42],[15,2,14,0],[15,6,14,4,"reconnectTimer"],[15,20,14,56],[15,23,14,59],[15,27,14,63],[16,2,16,0],[16,8,16,6,"getWsUrl"],[16,16,16,14],[16,19,16,17,"getWsUrl"],[16,20,16,17],[16,25,16,23],[17,4,17,2],[17,10,17,8,"base"],[17,14,17,12],[17,17,17,15,"API_BASE"],[17,27,17,23],[17,28,17,23,"API_BASE"],[17,36,17,23],[17,37,17,24,"replace"],[17,44,17,31],[17,45,17,32],[17,51,17,38],[17,53,17,40],[17,55,17,42],[17,56,17,43],[17,57,17,44,"replace"],[17,64,17,51],[17,65,17,52],[17,75,17,62],[17,77,17,64],[17,85,17,72],[17,86,17,73],[17,87,17,74,"replace"],[17,94,17,81],[17,95,17,82],[17,104,17,91],[17,106,17,93],[17,113,17,100],[17,114,17,101],[18,4,18,2],[18,11,18,9],[18,14,18,12,"base"],[18,18,18,16],[18,27,18,25],[19,2,19,0],[19,3,19,1],[20,2,21,0],[20,17,21,15,"connectWebSocket"],[20,33,21,31,"connectWebSocket"],[20,34,21,31],[20,36,21,34],[21,4,22,2],[21,10,22,8,"token"],[21,15,22,13],[21,18,22,16],[21,24,22,22],[21,28,22,22,"getToken"],[21,32,22,30],[21,33,22,30,"getToken"],[21,41,22,30],[21,43,22,31],[21,44,22,32],[22,4,23,2],[22,8,23,6],[22,9,23,7,"token"],[22,14,23,12],[22,18,23,16,"globalWs"],[22,26,23,24],[22,28,23,26,"readyState"],[22,38,23,36],[22,43,23,41,"WebSocket"],[22,52,23,50],[22,53,23,51,"OPEN"],[22,57,23,55],[22,59,23,57],[23,4,25,2],[23,8,25,6],[24,6,26,4],[24,12,26,10,"wsUrl"],[24,17,26,15],[24,20,26,18],[24,23,26,21,"getWsUrl"],[24,31,26,29],[24,32,26,30],[24,33,26,31],[24,37,26,35,"token"],[24,42,26,40],[24,44,26,42],[25,6,27,4,"globalWs"],[25,14,27,12],[25,17,27,15],[25,21,27,19,"WebSocket"],[25,30,27,28],[25,31,27,29,"wsUrl"],[25,36,27,34],[25,37,27,35],[26,6,29,4,"globalWs"],[26,14,29,12],[26,15,29,13,"onopen"],[26,21,29,19],[26,24,29,22],[26,30,29,28],[27,8,30,6,"console"],[27,15,30,13],[27,16,30,14,"log"],[27,19,30,17],[27,20,30,18],[27,36,30,34],[27,37,30,35],[28,8,31,6],[28,12,31,10,"reconnectTimer"],[28,26,31,24],[28,28,31,26,"clearTimeout"],[28,40,31,38],[28,41,31,39,"reconnectTimer"],[28,55,31,53],[28,56,31,54],[29,6,32,4],[29,7,32,5],[30,6,34,4,"globalWs"],[30,14,34,12],[30,15,34,13,"onmessage"],[30,24,34,22],[30,27,34,26,"event"],[30,32,34,31],[30,36,34,36],[31,8,35,6],[31,12,35,10],[32,10,36,8],[32,16,36,14,"data"],[32,20,36,18],[32,23,36,21,"JSON"],[32,27,36,25],[32,28,36,26,"parse"],[32,33,36,31],[32,34,36,32,"event"],[32,39,36,37],[32,40,36,38,"data"],[32,44,36,42],[32,45,36,43],[33,10,37,8,"listeners"],[33,19,37,17],[33,20,37,18,"forEach"],[33,27,37,25],[33,28,37,26,"cb"],[33,30,37,28],[33,34,37,32,"cb"],[33,36,37,34],[33,37,37,35,"data"],[33,41,37,39],[33,42,37,40],[33,43,37,41],[34,8,38,6],[34,9,38,7],[34,10,38,8],[34,16,38,14],[34,17,38,15],[35,6,39,4],[35,7,39,5],[36,6,41,4,"globalWs"],[36,14,41,12],[36,15,41,13,"onclose"],[36,22,41,20],[36,25,41,23],[36,31,41,29],[37,8,42,6,"console"],[37,15,42,13],[37,16,42,14,"log"],[37,19,42,17],[37,20,42,18],[37,56,42,54],[37,57,42,55],[38,8,43,6,"globalWs"],[38,16,43,14],[38,19,43,17],[38,23,43,21],[39,8,44,6,"reconnectTimer"],[39,22,44,20],[39,25,44,23,"setTimeout"],[39,35,44,33],[39,36,44,34,"connectWebSocket"],[39,52,44,50],[39,54,44,52],[39,58,44,56],[39,59,44,57],[40,6,45,4],[40,7,45,5],[41,6,47,4,"globalWs"],[41,14,47,12],[41,15,47,13,"onerror"],[41,22,47,20],[41,25,47,23],[41,31,47,29],[42,8,48,6,"globalWs"],[42,16,48,14],[42,18,48,16,"close"],[42,23,48,21],[42,24,48,22],[42,25,48,23],[43,6,49,4],[43,7,49,5],[45,6,51,4],[46,6,52,4],[46,12,52,10,"pingInterval"],[46,24,52,22],[46,27,52,25,"setInterval"],[46,38,52,36],[46,39,52,37],[46,45,52,43],[47,8,53,6],[47,12,53,10,"globalWs"],[47,20,53,18],[47,22,53,20,"readyState"],[47,32,53,30],[47,37,53,35,"WebSocket"],[47,46,53,44],[47,47,53,45,"OPEN"],[47,51,53,49],[47,53,53,51],[48,10,54,8,"globalWs"],[48,18,54,16],[48,19,54,17,"send"],[48,23,54,21],[48,24,54,22,"JSON"],[48,28,54,26],[48,29,54,27,"stringify"],[48,38,54,36],[48,39,54,37],[49,12,54,39,"type"],[49,16,54,43],[49,18,54,45],[50,10,54,52],[50,11,54,53],[50,12,54,54],[50,13,54,55],[51,8,55,6],[51,9,55,7],[51,15,55,13],[52,10,56,8,"clearInterval"],[52,23,56,21],[52,24,56,22,"pingInterval"],[52,36,56,34],[52,37,56,35],[53,8,57,6],[54,6,58,4],[54,7,58,5],[54,9,58,7],[54,14,58,12],[54,15,58,13],[55,4,59,2],[55,5,59,3],[55,6,59,4],[55,12,59,10],[56,6,60,4,"reconnectTimer"],[56,20,60,18],[56,23,60,21,"setTimeout"],[56,33,60,31],[56,34,60,32,"connectWebSocket"],[56,50,60,48],[56,52,60,50],[56,56,60,54],[56,57,60,55],[57,4,61,2],[58,2,62,0],[59,2,64,7],[59,11,64,16,"disconnectWebSocket"],[59,30,64,35,"disconnectWebSocket"],[59,31,64,35],[59,33,64,38],[60,4,65,2],[60,8,65,6,"reconnectTimer"],[60,22,65,20],[60,24,65,22,"clearTimeout"],[60,36,65,34],[60,37,65,35,"reconnectTimer"],[60,51,65,49],[60,52,65,50],[61,4,66,2,"reconnectTimer"],[61,18,66,16],[61,21,66,19],[61,25,66,23],[62,4,67,2,"globalWs"],[62,12,67,10],[62,14,67,12,"close"],[62,19,67,17],[62,20,67,18],[62,21,67,19],[63,4,68,2,"globalWs"],[63,12,68,10],[63,15,68,13],[63,19,68,17],[64,4,69,2,"listeners"],[64,13,69,11],[64,14,69,12,"clear"],[64,19,69,17],[64,20,69,18],[64,21,69,19],[65,2,70,0],[66,2,72,7],[66,11,72,16,"sendWsMessage"],[66,24,72,29,"sendWsMessage"],[66,25,72,30,"data"],[66,29,72,39],[66,31,72,41],[67,4,73,2],[67,8,73,6,"globalWs"],[67,16,73,14],[67,18,73,16,"readyState"],[67,28,73,26],[67,33,73,31,"WebSocket"],[67,42,73,40],[67,43,73,41,"OPEN"],[67,47,73,45],[67,49,73,47],[68,6,74,4,"globalWs"],[68,14,74,12],[68,15,74,13,"send"],[68,19,74,17],[68,20,74,18,"JSON"],[68,24,74,22],[68,25,74,23,"stringify"],[68,34,74,32],[68,35,74,33,"data"],[68,39,74,37],[68,40,74,38],[68,41,74,39],[69,4,75,2],[70,2,76,0],[71,2,78,7],[71,11,78,16,"useWebSocket"],[71,23,78,28,"useWebSocket"],[71,24,78,29,"onMessage"],[71,33,78,51],[71,35,78,53],[72,4,79,2],[72,10,79,8,"callbackRef"],[72,21,79,19],[72,24,79,22],[72,28,79,22,"useRef"],[72,34,79,28],[72,35,79,28,"useRef"],[72,41,79,28],[72,43,79,29,"onMessage"],[72,52,79,38],[72,53,79,39],[73,4,80,2,"callbackRef"],[73,15,80,13],[73,16,80,14,"current"],[73,23,80,21],[73,26,80,24,"onMessage"],[73,35,80,33],[74,4,82,2],[74,8,82,2,"useEffect"],[74,14,82,11],[74,15,82,11,"useEffect"],[74,24,82,11],[74,26,82,12],[74,32,82,18],[75,6,83,4,"connectWebSocket"],[75,22,83,20],[75,23,83,21],[75,24,83,22],[76,6,85,4],[76,12,85,10,"handler"],[76,19,85,29],[76,22,85,33,"msg"],[76,25,85,36],[76,29,85,41],[77,8,86,6,"callbackRef"],[77,19,86,17],[77,20,86,18,"current"],[77,27,86,25],[77,30,86,28,"msg"],[77,33,86,31],[77,34,86,32],[78,6,87,4],[78,7,87,5],[79,6,89,4],[79,10,89,8,"onMessage"],[79,19,89,17],[79,21,89,19],[80,8,90,6,"listeners"],[80,17,90,15],[80,18,90,16,"add"],[80,21,90,19],[80,22,90,20,"handler"],[80,29,90,27],[80,30,90,28],[81,6,91,4],[82,6,93,4],[82,13,93,11],[82,19,93,17],[83,8,94,6,"listeners"],[83,17,94,15],[83,18,94,16,"delete"],[83,24,94,22],[83,25,94,23,"handler"],[83,32,94,30],[83,33,94,31],[84,6,95,4],[84,7,95,5],[85,4,96,2],[85,5,96,3],[85,7,96,5],[85,9,96,7],[85,10,96,8],[86,4,98,2],[86,11,98,9],[87,6,98,11,"sendMessage"],[87,17,98,22],[87,19,98,24,"sendWsMessage"],[88,4,98,38],[88,5,98,39],[89,2,99,0],[90,0,99,1],[90,3]],"functionMap":{"names":["<global>","getWsUrl","connectWebSocket","globalWs.onopen","globalWs.onmessage","listeners.forEach$argument_0","globalWs.onclose","globalWs.onerror","setInterval$argument_0","disconnectWebSocket","sendWsMessage","useWebSocket","useEffect$argument_0","handler","<anonymous>"],"mappings":"AAA;iBCe;CDG;AEE;sBCQ;KDG;yBEE;0BCG,cD;KFE;uBIE;KJI;uBKE;KLE;qCMG;KNM;CFI;OSE;CTM;OUE;CVI;OWE;YCI;gCCG;KDE;WEM;KFE;GDC;CXG"},"hasCjsExports":false},"type":"js/module"}]}